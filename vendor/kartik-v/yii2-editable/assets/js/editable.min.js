/*!
 * @package   yii2-editable
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015 - 2017
 * @version   1.7.5
 *
 * Editable Extension jQuery plugin
 *
 * Built for Yii Framework 2.0
 * Author: Kartik Visweswaran
 * Year: 2015
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t=function(t,i){return null===t||void 0===t||0===t.length||i&&""===e.trim(t)},i=function(e,t){e.removeClass(t).addClass(t)},a=function(t,i){var a=this;a.$container=e(t),a.init(i),a.destroy(),a.create()};a.prototype={constructor:a,init:function(t){var i=this,a=i.$container;i.$input=a.find(".kv-editable-input"),i.$form=a.find(".kv-editable-form"),i.$value=a.find(".kv-editable-value"),i.$close=a.find(".kv-editable-close"),i.$popover=a.find(".kv-editable-popover"),i.$inline=a.find(".kv-editable-inline"),i.$btnSubmit=a.find("button.kv-editable-submit"),i.$btnReset=a.find("button.kv-editable-reset"),i.$loading=a.find(".kv-editable-loading"),i.$target=a.find(t.target),e.each(t,function(e,t){i[e]=t})},htmlEncode:function(t){var i=this;return i.encodeOutput?("object"==typeof t&&e.each(t,function(e,a){t[e]=i.htmlEncode(a)}),t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")):t},toggle:function(e,t){var a=this,o=a.$value,n=a.$inline;return t=t||"fast",e?void(a.asPopover||o.fadeOut(t,function(){n.fadeIn(t),".kv-editable-button"===a.target&&i(a.$target,"kv-inline-open")})):void(a.asPopover?a.$popover.popoverX("hide"):n.fadeOut(t,function(){o.fadeIn(t),a.$target.removeClass("kv-inline-open")}))},refreshPopover:function(){var e=this;e.asPopover&&e.$popover.popoverX("refreshPosition")},raise:function(t,i,a){var o=e.Event(i);return void 0!==a?t.trigger(o,a):t.trigger(o),!o.isDefaultPrevented()},destroy:function(){var e=this,t=".kv-editable-button"===e.target?e.$target:e.$value;e.$form.off(".editable"),e.$form.find("input, select").off(".editable"),e.$close.off(".editable"),e.$btnSubmit.off(".editable"),e.$btnReset.off(".editable"),t.off(".editable")},create:function(){var a,o=this,n=o.$form,r=o.$btnSubmit,l=o.$btnReset,s=n.parent(),d=o.$container,c=o.$close,u=o.$inline,f=".kv-editable-button"===o.target?o.$target:o.$value,v=o.$loading,b=o.$input,p="",h="",m=n.data("yiiActiveForm"),g=b.closest(".field-"+b.attr("id")),$=g.find(".help-block"),k=b.closest(".kv-editable-parent"),y=o.displayValueConfig,C=t(g.attr("class"))||t($.attr("class")),E=n.find('input[name="hasEditable"]'),w=k.find(".kv-help-block");a=function(t){C?(w.length||(w=e(document.createElement("div")).attr({"class":"help-block kv-help-block"}).appendTo(k)),w.html(t).show()):(i($,"kv-help-block"),$.html(t).show()),i(k,"has-error"),v.hide(),s.removeClass("kv-editable-processing")},n.on("submit.editable",function(e){e.preventDefault()}).on("keyup.editable",function(e){13===e.which&&o.submitOnEnter&&o.raise(r,"click.editable")}).on("reset.editable",function(){setTimeout(function(){n.data("kvEditableSubmit",!1),C?(k.find(".help-block").remove(),k.removeClass("has-error")):(g.removeClass("has-error"),$.html(" ")),o.refreshPopover()},200)}),n.find("input, select").on("change.editable",function(){o.raise(d,"editableChange",[b.val()])&&o.refreshPopover()}),l.on("click.editable",function(){o.raise(d,"editableReset")&&(E.val(0),setTimeout(function(){n[0].reset()},200))}),c.on("click.editable",function(){o.toggle(!1)}),f.on("click.editable",function(){if(o.asPopover)return void o.toggle(!0);var e=!o.$inline.is(":visible");o.toggle(e)}),r.on("click.editable",function(){var r,l=o.asPopover?s:u,c=!1;i(l,"kv-editable-processing"),v.show(),E.val(1),n.find(".help-block").each(function(){e(this).html("")}),n.find(".has-error").removeClass("has-error"),n.find("input, select").each(function(){var t=e(this),i=t.val(),a=i,n="file"===t.attr("type");c||(c=n),t.attr("disabled")||(n?o.raise(t,"blur"):(e.isArray(i)?a.push("-"):a+="-",t.val(a),o.raise(t,"blur"),t.val(i),o.raise(t,"blur")))}),r={type:n.attr("method"),url:n.attr("action"),dataType:"json",beforeSend:function(e){o.raise(d,"editableBeforeSubmit",[e])||e.abort()},error:function(e,t,i){o.raise(d,"editableAjaxError",[e,t,i])&&o.showAjaxErrors&&a(i)},success:function(i,r,s){return p="",h=t(i.output)?o.htmlEncode(b.val()):i.output,o.refreshPopover(),t(i.message)?(t(w.attr("class"))||(g.removeClass("has-error"),w.html("").hide(),$.html("")),n.find(".help-block").each(function(){var i=e(this).text();p+=i?i.trim():"",t(p)||v.hide()}),t(p)?o.raise(d,"editableSuccess",[b.val(),n,i,r,s])&&(v.hide(),t(h)?h=o.valueIfNull:void 0!==y[h]&&(h=y[h]),C?(k.find(".help-block").remove(),k.removeClass("has-error"),$.html(""),o.toggle(!1),o.$value.html(h)):(g.removeClass("has-error"),$.html(""),o.toggle(!1),o.$value.html(h),m&&(n.yiiActiveForm("destroy"),n.yiiActiveForm(m.attributes,m.settings)))):o.raise(d,"editableError",[b.val(),n,i]),void l.removeClass("kv-editable-processing")):void(o.raise(d,"editableError",[b.val(),n,i])&&a(i.message))}},c&&window.FormData?(n.attr("enctype","multipart/form-data"),r.data=new FormData(n[0]),r.contentType=!1,r.processData=!1,r.cache=!1):r.data=n.serialize(),setTimeout(function(){o.raise(d,"editableSubmit",[b.val(),n])&&e.ajax(e.extend(!0,r,o.ajaxSettings))},o.validationDelay)})}},e.fn.editable=function(t){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var o=e(this),n=o.data("editable"),r="object"==typeof t&&t;n||(n=new a(this,e.extend({},e.fn.editable.defaults,r,e(this).data())),o.data("editable",n)),"string"==typeof t&&n[t].apply(n,i)})},e.fn.editable.defaults={valueIfNull:"<em>(not set)</em>",placement:"right",displayValueConfig:{},ajaxSettings:{},showAjaxErrors:!0,submitOnEnter:!0,asPopover:!0,encodeOutput:!0,validationDelay:500},e.fn.editable.Constructor=a}(window.jQuery);